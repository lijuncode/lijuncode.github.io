<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>LiJun&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="iOS开发者，正在不断学习编程之道。">
<meta property="og:type" content="website">
<meta property="og:title" content="LiJun&#39;s Blog">
<meta property="og:url" content="http://lijun.xyz/page/3/index.html">
<meta property="og:site_name" content="LiJun&#39;s Blog">
<meta property="og:description" content="iOS开发者，正在不断学习编程之道。">
<meta property="og:locale">
<meta property="article:author" content="lijun">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="LiJun's Blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">LiJun&#39;s Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Suche"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Suche"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://lijun.xyz"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-SICP-1-1" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2016/10/11/SICP-1-1/" class="article-date">
  <time class="dt-published" datetime="2016-10-11T14:15:13.000Z" itemprop="datePublished">2016-10-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programming/">Programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2016/10/11/SICP-1-1/">SICP-1.1程序设计的基本元素</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>每一种强有力的语言都为此提供三种机制：</p>
<ul>
<li>基本的表达形式，用于表示语言所关心的最简单的个体。</li>
<li>组合的方式，通过它们可以从较简单的东西出发构造出复合的元素。</li>
<li>抽象的方法，通过它们可以为复合对象命名，并将它们当作单元去操作。<br>在程序设计中，我们需要处理两类要素：过程和数据。而这两者并不是严格分离的，数据是一种我们希望去操作的东西，而过程是有关操作这些数据的规则的描述。这样，任何强有力的程序设计语言都必须能表述基本的数据和基本的过程，还需要提供对过程和数据进行组合和抽象的过程。</li>
</ul>
</blockquote>
        
          <p class="article-more-link">
            <a href="/2016/10/11/SICP-1-1/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://lijun.xyz/2016/10/11/SICP-1-1/" data-id="ckilyqj99000ayps62khx5sy7" data-title="SICP-1.1程序设计的基本元素" class="article-share-link">Teilen</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Programming/" rel="tag">Programming</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SICP/" rel="tag">SICP</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Swift字符串长度" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2016/09/27/Swift%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%95%BF%E5%BA%A6/" class="article-date">
  <time class="dt-published" datetime="2016-09-26T23:42:01.000Z" itemprop="datePublished">2016-09-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programming/">Programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2016/09/27/Swift%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%95%BF%E5%BA%A6/">《Advanced Swift》笔记：Swift字符串长度</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> str = <span class="string">&quot;Pokémon&quot;</span></span><br><span class="line"><span class="keyword">var</span> nsstr = str <span class="keyword">as</span> <span class="type">NSString</span></span><br><span class="line">str.characters.<span class="built_in">count</span>  <span class="comment">// 7</span></span><br><span class="line">nsstr.length			<span class="comment">// 8</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>如上，同样一个字符串，在String和NSString下，它的长度却不一样。因为Unicode编码是一种可变长格式，Unicode字符串是由编码点（code point）组成，而编码点又是由编码单元（code unit）组成。在不同的编码标准下，同一个字符串，可能会有不同的编码方式。Swift中的String内部实现尽量符合“标准等价”的编码规范，使我们更准确的处理字符长度。</p>
        
          <p class="article-more-link">
            <a href="/2016/09/27/Swift%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%95%BF%E5%BA%A6/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://lijun.xyz/2016/09/27/Swift%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%95%BF%E5%BA%A6/" data-id="ckilyqj9i000zyps67vvnf3qy" data-title="《Advanced Swift》笔记：Swift字符串长度" class="article-share-link">Teilen</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/String/" rel="tag">String</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Swift/" rel="tag">Swift</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Swift3-0的访问控制" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2016/09/25/Swift3-0%E7%9A%84%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6/" class="article-date">
  <time class="dt-published" datetime="2016-09-25T07:48:42.000Z" itemprop="datePublished">2016-09-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programming/">Programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2016/09/25/Swift3-0%E7%9A%84%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6/">Swift3.0的访问控制</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>在Swift3.0之前，访问控制分为三种：public、internal、private。而在Swift3.0，实际上有5种。</p>
<ul>
<li>Open， 最高访问控制，通过引入这个模块，外部文件就能使用它，并且可以继承和覆盖重写。</li>
<li>Public， 次高访问控制，通过引入这个模块，外部文件就能使用它，但不能继承和覆盖重写。</li>
<li>Internal， 模块内部任何文件可以访问。</li>
<li>File-private, 文件内部才能访问。</li>
<li>Private， 代码作用域内才能访问。</li>
</ul>
<p>默认的访问控制类型是Internal。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://lijun.xyz/2016/09/25/Swift3-0%E7%9A%84%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6/" data-id="ckilyqj9e000lyps6d5j87boe" data-title="Swift3.0的访问控制" class="article-share-link">Teilen</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Programming/" rel="tag">Programming</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Swift/" rel="tag">Swift</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-在Swift结构体中实现写时复制" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2016/09/11/%E5%9C%A8Swift%E7%BB%93%E6%9E%84%E4%BD%93%E4%B8%AD%E5%AE%9E%E7%8E%B0%E5%86%99%E6%97%B6%E5%A4%8D%E5%88%B6/" class="article-date">
  <time class="dt-published" datetime="2016-09-11T14:12:43.000Z" itemprop="datePublished">2016-09-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programming/">Programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2016/09/11/%E5%9C%A8Swift%E7%BB%93%E6%9E%84%E4%BD%93%E4%B8%AD%E5%AE%9E%E7%8E%B0%E5%86%99%E6%97%B6%E5%A4%8D%E5%88%B6/">在Swift结构体中实现写时复制</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>结构体（Struct)在Swift中占有重要地位，在Swift标准库中，大约有90%的公开类型都是结构体，包括我们常用的Array、String、Dictionary。结构体相比类，一个最重要的特性就是它是值类型，而类似引用类型。值类型是通过复制值来赋值的，而不是引用同一个内存地址，这样就不存在数据共享的问题，能防止意外的数据改变，并且它是线程安全的。</p>
<p>举一个很简单的例子，在objc中，数组是类，是引用类型，在Swift中，数组是结构体，是值类型。因此下面的代码中：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">let</span> array1 = <span class="type">NSMutableArray</span>(array: [<span class="string">&quot;lihua&quot;</span>, <span class="string">&quot;liming&quot;</span>])</span><br><span class="line"><span class="keyword">let</span> array2 = array1</span><br><span class="line"></span><br><span class="line">array1.addObject(<span class="string">&quot;xiaowang&quot;</span>)</span><br><span class="line">array2</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>array1</code>和<code>array2</code>最后都变成了<code>[&quot;lihua&quot;, &quot;liming&quot;, &quot;xiaowang&quot;]</code>，也就是<code>array1</code>的改变会导致<code>array2</code>也发生改变，因为它们两个都是引用类型，并且都引用了同一个内存地址。</p>
<p>而在Swift中，就不存在这样的问题：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> array3 = [<span class="string">&quot;lihua&quot;</span>, <span class="string">&quot;liming&quot;</span>]</span><br><span class="line"><span class="keyword">var</span> array4 = array3</span><br><span class="line"></span><br><span class="line">array3.append(<span class="string">&quot;xiaowang&quot;</span>)</span><br><span class="line">array4</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这段代码执行后，<code>array3</code>变成了<code>[&quot;lihua&quot;, &quot;liming&quot;, &quot;xiaowang&quot;]</code>，而<code>array4</code>还是<code>[&quot;lihua&quot;, &quot;liming&quot;]</code>。这就是结构体和类的最大区别。</p>
<p>那么，是不是每次将struct赋值给其它变量或者传递给函数时都会发生复制呢。答案是否定的，在Swift中的Array、Dictionary、String这些类型中，尽管它们都是值类型，但在Swift的具体实现中做了优化，可以避免不必要的复制。在《The Swift Programming Language (Swift 2.2)》一书的“Classes and Structures”一章末尾写道：</p>
<blockquote>
<p>The description above refers to the “copying” of strings, arrays, and dictionaries. The behavior you see in your code will always be as if a copy took place. However, Swift only performs an actual copy behind the scenes when it is absolutely necessary to do so. Swift manages all value copying to ensure optimal performance, and you should not avoid assignment to try to preempt this optimization.</p>
</blockquote>
<p>在Swift中采用的优化方式叫做写时复制技术，简单的说就是，只有当一个结构体发生了写入行为时才会有复制行为。具体的做法就是，在结构体内部用一个引用类型来存储实际的数据，在不进行写入操作的普通传递过程中，都是将内部的reference的应用计数+1，在进行写入操作时，对内部的reference做一次copy操作用来存储新的数据，防止和之前的reference产生意外的数据共享。</p>
<p>在Swift中有一个方法：<code>isUniquelyReferencedNonObjC</code>(Swift 2.2)，在Swift3中这个函数变成了这样：<code>isKnownUniquelyReferenced</code>，他能检查一个类的实例是不是唯一的引用，如果是，我们就不需要对结构体实例进行复制，如果不是，说明对象被不同的结构体共享，这时对它进行更改就需要进行复制。</p>
<p>但这个函数只对Swift对象有用，如果要用在Objective-C对象上，可以将OC对象用Swift进行一次封装。</p>
<p>下面是《Advanced Swift》书中的一个实现写时复制技术的代码实例，我已经把它转为Swift3了：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Box</span>&lt;<span class="title">A</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> unbox: <span class="type">A</span></span><br><span class="line">  <span class="keyword">init</span>(<span class="keyword">_</span> value: <span class="type">A</span>) &#123;</span><br><span class="line">    unbox = value</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">GaussianBlur</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> boxedFilter: <span class="type">Box</span>&lt;<span class="type">CIFilter</span>&gt; = &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">filter</span> = <span class="type">CIFilter</span>(name: <span class="string">&quot;CIGaussianBlur&quot;</span>, withInputParameters: [:])!</span><br><span class="line">    <span class="built_in">filter</span>.setDefaults()</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Box</span>(<span class="built_in">filter</span>)</span><br><span class="line">  &#125;()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">fileprivate</span> <span class="keyword">var</span> <span class="built_in">filter</span>: <span class="type">CIFilter</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> &#123; <span class="keyword">return</span> boxedFilter.unbox &#125;</span><br><span class="line">    <span class="keyword">set</span> &#123; boxedFilter = <span class="type">Box</span>(newValue) &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> filterForWriting: <span class="type">CIFilter</span> &#123;</span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">get</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> !isKnownUniquelyReferenced(&amp;boxedFilter) &#123;</span><br><span class="line">        <span class="built_in">filter</span> = <span class="built_in">filter</span>.copy() <span class="keyword">as</span>! <span class="type">CIFilter</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">filter</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> inputImage: <span class="type">CIImage</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> &#123; <span class="keyword">return</span> <span class="built_in">filter</span>.value(forKey: kCIInputImageKey) <span class="keyword">as</span>! <span class="type">CIImage</span> &#125;</span><br><span class="line">    <span class="keyword">set</span> &#123; filterForWriting.setValue(newValue, forKey: kCIInputImageKey) &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> radius: <span class="type">Double</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> &#123; <span class="keyword">return</span> <span class="built_in">filter</span>.value(forKey: kCIInputRadiusKey) <span class="keyword">as</span>! <span class="type">Double</span> &#125;</span><br><span class="line">    <span class="keyword">set</span> &#123; filterForWriting.setValue(newValue, forKey: kCIInputRadiusKey) &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">GaussianBlur</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> outputImage: <span class="type">CIImage?</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">filter</span>.outputImage</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



      
    </div>
    <footer class="article-footer">
      <a data-url="http://lijun.xyz/2016/09/11/%E5%9C%A8Swift%E7%BB%93%E6%9E%84%E4%BD%93%E4%B8%AD%E5%AE%9E%E7%8E%B0%E5%86%99%E6%97%B6%E5%A4%8D%E5%88%B6/" data-id="ckilyqjaa0048yps6hyan15hx" data-title="在Swift结构体中实现写时复制" class="article-share-link">Teilen</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Swift/" rel="tag">Swift</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/programming/" rel="tag">programming</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-slice" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2016/08/11/slice/" class="article-date">
  <time class="dt-published" datetime="2016-08-11T00:11:16.000Z" itemprop="datePublished">2016-08-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programming/">Programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2016/08/11/slice/">《Advanced Swift》笔记4:切片（Slice）</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>切片（Slice）是基于任何集合类型（遵守CollectionType的类型）的轻量级封装，默认的实现是返回了一个对原来集合的封装，再加上一个索引的子范围，所以它的内存大小会比原来更大。而且包括Swift的数组和字符串在内的很多可切片的容器，切片和原集合共享存储缓存，这会导致即使原集合离开了作用域，切片依然会持有原集合的缓存，这可能会导致内存问题。</p>
<blockquote>
<p>With many sliceable containers, including Swift’s arrays and strings, a slice shares the storage buffer of the original collection. This has an unpleasant side effect: slices can keep the original collection’s buffer alive in its entirety, even if the original collection falls out of scope. If you read a 1 GB file into an array or string, and then slice off a tiny part, the whole 1 GB buffer will stay in memory until both the collection and the slice are destroyed.</p>
</blockquote>
<p>另外，因为切片改变了索引范围，因此我们不能默认其索引是从0开始，而应该是从其startIndex开始，这也是为什么在Swift中应该用 for in 循环，而弃用C风格的for循环的原因之一。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> array = [<span class="number">1</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">34</span>, <span class="number">33</span>, <span class="number">88</span>, <span class="number">43</span>]</span><br><span class="line"><span class="keyword">let</span> subArray = array.suffixFrom(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// subArray改变了索引范围，即改变了startIndex和endIndex。</span></span><br><span class="line">subArray.startIndex  <span class="comment">// 4</span></span><br><span class="line">subArray.endIndex    <span class="comment">// 9</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 因为subArray占用的内存比原集合更大</span></span><br><span class="line"><span class="built_in">sizeofValue</span>(array)      <span class="comment">// 8</span></span><br><span class="line"><span class="built_in">sizeofValue</span>(subArray)   <span class="comment">// 32</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// subArray持有原集合，只是改变了索引范围</span></span><br><span class="line"><span class="comment">// 所以直接以数字为索引，很容易出错。</span></span><br><span class="line"><span class="comment">// 标准的索引：</span></span><br><span class="line">subArray[subArray.startIndex.advancedBy(<span class="number">0</span>)]</span><br><span class="line">subArray[<span class="number">0</span>]  <span class="comment">//这一句会报错，因为subArray.startIndex 是4，0越界了。</span></span><br><span class="line">subArray.<span class="built_in">count</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 这也是Swift中弃用传统C风格的for循环，改用for in循环的原因之一。</span></span><br><span class="line"><span class="keyword">for</span> int <span class="keyword">in</span> subArray &#123;</span><br><span class="line">  <span class="built_in">print</span>(int)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



      
    </div>
    <footer class="article-footer">
      <a data-url="http://lijun.xyz/2016/08/11/slice/" data-id="ckilyqja8003xyps6hmwhg5qq" data-title="《Advanced Swift》笔记4:切片（Slice）" class="article-share-link">Teilen</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Programming/" rel="tag">Programming</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Swift/" rel="tag">Swift</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-MYArray-Swift" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2016/08/07/MYArray-Swift/" class="article-date">
  <time class="dt-published" datetime="2016-08-07T14:03:32.000Z" itemprop="datePublished">2016-08-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programming/">Programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2016/08/07/MYArray-Swift/">《Advanced Swift》笔记3：如何自己实现一个Swift数组</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>本文中，我们将会探索Swift原生Array数组的实现方式，并且自定义实现一个数组类型，能够字面量来创建数组，通过下标来获取元素。</p>
<p>通过查看文档我们发现，Swift的数组是一个结构体类型，它遵守了<code>CollectionType</code>、<code>MutableCollectionType</code>、<code>_DstructorSafeContainer</code>协议，其中最重要的就是<code>CollectionType</code>协议，数组的一些主要功能都是通过这个协议实现的。<br>而<code>CollectionType</code>协议又遵守<code>Indexable</code>和<code>SequenceType</code>这两个协议。而在这两个协议中，<code>SequenceType</code>协议是数组、字典等集合类型最重要的协议，在文档中解释了<code>SequenceType</code>是一个可以通过<code>for</code>…<code>in</code>循环迭代的类型，实现了这个协议，就可以<code>for</code>…<code>in</code>循环了。</p>
<blockquote>
<p>A type that can be iterated with a <code>for</code>…<code>in</code> loop.</p>
</blockquote>
<p>而<code>SequenceType</code>是建立在<code>GeneratorType</code>基础上的，sequence需要<code>GeneratorType</code>来告诉它如何生成元素。</p>
<!--- more --->

<h2 id="GeneratorType"><a href="#GeneratorType" class="headerlink" title="GeneratorType"></a>GeneratorType</h2><p><code>GeneratorType</code>协议有两部分组成：</p>
<ol>
<li>它需要有一个<code>Element</code>关联类型，这也是它产生的值的类型。</li>
<li>它需要有一个<code>next</code>方法。这个方法返回<code>Element</code>的可选对象。通过这个方法就可以一直获取下一个元素，直到返回nil，就意味着已经获取到了所有元素。</li>
</ol>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Encapsulates iteration state and interface for iteration over a</span></span><br><span class="line"><span class="comment">/// sequence.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// - Note: While it is safe to copy a generator, advancing one</span></span><br><span class="line"><span class="comment">///   copy may invalidate the others.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// Any code that uses multiple generators (or `for`...`in` loops)</span></span><br><span class="line"><span class="comment">/// over a single sequence should have static knowledge that the</span></span><br><span class="line"><span class="comment">/// specific sequence is multi-pass, either because its concrete</span></span><br><span class="line"><span class="comment">/// type is known or because it is constrained to `CollectionType`.</span></span><br><span class="line"><span class="comment">/// Also, the generators must be obtained by distinct calls to the</span></span><br><span class="line"><span class="comment">/// sequence&#x27;s `generate()` method, rather than by copying.</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">GeneratorType</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// The type of element generated by `self`.</span></span><br><span class="line">    <span class="keyword">associatedtype</span> <span class="type">Element</span></span><br><span class="line">    <span class="comment">/// Advance to the next element and return it, or `nil` if no next</span></span><br><span class="line">    <span class="comment">/// element exists.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Requires: `next()` has not been applied to a copy of `self`</span></span><br><span class="line">    <span class="comment">///   since the copy was made, and no preceding call to `self.next()`</span></span><br><span class="line">    <span class="comment">///   has returned `nil`.  Specific implementations of this protocol</span></span><br><span class="line">    <span class="comment">///   are encouraged to respond to violations of this requirement by</span></span><br><span class="line">    <span class="comment">///   calling `preconditionFailure(&quot;...&quot;)`.</span></span><br><span class="line">    <span class="meta">@warn_unused_result</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">next</span><span class="params">()</span></span> -&gt; <span class="type">Self</span>.<span class="type">Element?</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我把自己实现的数组命名为<code>MYArray</code>，generator为<code>MYArrayGenerator</code>，为了简单，这里通过字典来存储数据，并约定字典的key为从0开始的连续数字。就可以这样来实现<code>GeneratorType</code>:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 需保准dic的key是从0开始的连续数字</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MYArrayGenerator</span>&lt;<span class="title">T</span>&gt;: <span class="title">GeneratorType</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> dic: [<span class="type">Int</span>: <span class="type">T</span>]</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> index = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">init</span>(dic: [<span class="type">Int</span>: <span class="type">T</span>]) &#123;</span><br><span class="line">    <span class="keyword">self</span>.dic = dic</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">next</span><span class="params">()</span></span> -&gt; <span class="type">T?</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> element = dic[index]</span><br><span class="line">    index += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> element</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这里通过<code>next</code>方法的返回值，隐式地为Element赋值。显式地赋值可以这样写<code>typealias Element = T</code>。要使用这个生成器就非常简单了：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> dic = [<span class="number">0</span>: <span class="string">&quot;XiaoHong&quot;</span>, <span class="number">1</span>: <span class="string">&quot;XiaoMing&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> generator = <span class="type">MYArrayGenerator</span>(dic: dic)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">let</span> elment = generator.next() &#123;</span><br><span class="line">  <span class="built_in">print</span>(elment)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 打印的结果：</span></span><br><span class="line"><span class="comment">// XiaoHong</span></span><br><span class="line"><span class="comment">// XiaoMing</span></span><br></pre></td></tr></table></figure>

<h2 id="SequenceType"><a href="#SequenceType" class="headerlink" title="SequenceType"></a>SequenceType</h2><p>有了generator，接下来就可以实现<code>SequenceType</code>协议了。<code>SequenceType</code>协议也是主要有两部分：</p>
<ol>
<li>   需要有一个Generator关联类型，它要遵守<code>GeneratorType</code>。</li>
<li>要实现一个<code>generate</code>方法，返回一个Generator。<br>同样的，我们可以通过制定<code>generate</code>方法的方法类型来隐式地设置Generator：</li>
</ol>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MYArray</span>&lt;<span class="title">T</span>&gt;: <span class="title">SequenceType</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> dic: [<span class="type">Int</span>: <span class="type">T</span>]</span><br><span class="line">	</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">generate</span><span class="params">()</span></span> -&gt; <span class="type">MYArrayGenerator</span>&lt;<span class="type">T</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">MYArrayGenerator</span>(dic: dic)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这样我们就可以创建一个<code>MYArray</code>实例，并通过for循环来迭代：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> dic = [<span class="number">0</span>: <span class="string">&quot;XiaoHong&quot;</span>, <span class="number">1</span>: <span class="string">&quot;XiaoMing&quot;</span>, <span class="number">2</span>: <span class="string">&quot;XiaoWang&quot;</span>, <span class="number">3</span>: <span class="string">&quot;XiaoHuang&quot;</span>, <span class="number">4</span>: <span class="string">&quot;XiaoLi&quot;</span>]</span><br><span class="line"><span class="keyword">let</span> array = <span class="type">MYArray</span>(dic: dic)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> value <span class="keyword">in</span> array &#123;</span><br><span class="line">  <span class="built_in">print</span>(value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> names = array.<span class="built_in">map</span> &#123; $<span class="number">0</span> &#125;</span><br></pre></td></tr></table></figure>
<p>当然，目前这个实现还存在很大的隐患，因为传入的字典的key是不可知的，虽然我们限定了必须是Int类型，但无法保证它一定是从0开始，并且是连续，因此我们可以通过修改初始化方法来改进：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">init</span>(elements: <span class="type">T</span>...) &#123;</span><br><span class="line">    dic = [<span class="type">Int</span>: <span class="type">T</span>]()</span><br><span class="line">    elements.forEach &#123; dic[dic.<span class="built_in">count</span>] = $<span class="number">0</span> &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>然后我们就可以通过传入多参数来创建实例了：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> array = <span class="type">MYArray</span>(elements: <span class="string">&quot;XiaoHong&quot;</span>, <span class="string">&quot;XiaoMing&quot;</span>, <span class="string">&quot;XiaoWang&quot;</span>, <span class="string">&quot;XiaoHuang&quot;</span>, <span class="string">&quot;XiaoLi&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>再进一步，通过实现<code>ArrayLiteralConvertible</code>协议，我们可以像系统的Array数组一样，通过字面量来创建实例：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">MYArray</span>: <span class="title">ArrayLiteralConvertible</span> </span>&#123;</span><br><span class="line">  <span class="keyword">init</span>(arrayLiteral elements: <span class="type">T</span>...) &#123;</span><br><span class="line">    dic = [<span class="type">Int</span>: <span class="type">T</span>]()</span><br><span class="line">    elements.forEach &#123; dic[dic.<span class="built_in">count</span>] = $<span class="number">0</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> array = [<span class="string">&quot;XiaoHong&quot;</span>, <span class="string">&quot;XiaoMing&quot;</span>, <span class="string">&quot;XiaoWang&quot;</span>, <span class="string">&quot;XiaoHuang&quot;</span>, <span class="string">&quot;XiaoLi&quot;</span>]</span><br></pre></td></tr></table></figure>
<p>最后还有一个数组的重要特性，就是通过下标来取值，这个特性我们可以通过实现<code>subscript</code>方法来实现：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">MYArray</span> </span>&#123;</span><br><span class="line">  <span class="keyword">subscript</span>(idx: <span class="type">Int</span>) -&gt; <span class="type">Element</span> &#123;</span><br><span class="line">    <span class="built_in">precondition</span>(idx &lt; dic.<span class="built_in">count</span>, <span class="string">&quot;Index out of bounds&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> dic[idx]!</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(array[<span class="number">3</span>]) <span class="comment">// XiaoHuang</span></span><br></pre></td></tr></table></figure>
<p>至此，一个自定义的数组就基本实现了，我们可以通过字面量来创建一个数组，可以通过下标来取值，可以通过for循环来遍历数组，可以使用map、forEach等高阶函数。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><blockquote>
<p>要实现一个数组的功能，主要是通过实现<code>SequenceType</code>协议。<code>SequenceType</code>协议有一个Generator实现<code>GeneratorType</code>协议，并通过Generator的<code>next</code>方法来取值，这样就可以通过连续取值，来实现for循环遍历了。同时通过实现<code>ArrayLiteralConvertible</code>协议和<code>subscript</code>，就可以通过字面量来创建数组，并通过下标来取值。</p>
</blockquote>
<h2 id="CollectionType"><a href="#CollectionType" class="headerlink" title="CollectionType"></a>CollectionType</h2><p>上面我们为了弄清楚<code>SequenceType</code>的实现原理，通过实现<code>SequenceType</code>和<code>GeneratorType</code>来实现数组，但实际上Swift系统的Array类型是通过实现<code>CollectionType</code>来获得这些特性的，而<code>CollectionType</code>协议又遵守<code>Indexable</code>和<code>SequenceType</code>这两个协议。并扩展了两个关联类型<code>Generator</code>和<code>SubSequence</code>，以及9个方法，但这两个关联类型都是默认值，而且9个方法也都在协议扩展中有默认实现。<br>因此，我们只需要为<code>Indexable</code>协议中要求的 <code>startIndex</code> 和 <code>endIndex</code> 提供实现，并且实现一个通过下标索引来获取对应索引的元素的方法。只要我们实现了这三个需求，我们就能让一个类型遵守 <code>CollectionType</code> 了。因此这个自定义的数组可以这样实现：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MYArray</span>&lt;<span class="title">Element</span>&gt;: <span class="title">CollectionType</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> dic: [<span class="type">Int</span>: <span class="type">Element</span>]</span><br><span class="line"></span><br><span class="line">  <span class="keyword">init</span>(elements: <span class="type">Element</span>...) &#123;</span><br><span class="line">    dic = [<span class="type">Int</span>: <span class="type">Element</span>]()</span><br><span class="line">    elements.forEach &#123; dic[dic.<span class="built_in">count</span>] = $<span class="number">0</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> startIndex: <span class="type">Int</span> &#123; <span class="keyword">return</span> <span class="number">0</span> &#125;</span><br><span class="line">  <span class="keyword">var</span> endIndex: <span class="type">Int</span> &#123; <span class="keyword">return</span> dic.<span class="built_in">count</span> &#125;</span><br><span class="line">  <span class="keyword">subscript</span>(idx: <span class="type">Int</span>) -&gt; <span class="type">Element</span> &#123;</span><br><span class="line">    <span class="built_in">precondition</span>(idx &lt; endIndex, <span class="string">&quot;Index out of bounds&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> dic[idx]!</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">MYArray</span>: <span class="title">ArrayLiteralConvertible</span> </span>&#123;</span><br><span class="line">  <span class="keyword">init</span>(arrayLiteral elements: <span class="type">Element</span>...) &#123;</span><br><span class="line">    dic = [<span class="type">Int</span>: <span class="type">Element</span>]()</span><br><span class="line">    elements.forEach &#123; dic[dic.<span class="built_in">count</span>] = $<span class="number">0</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注意：</strong>在Swift 3 中，<code>SequenceType</code>、<code>GeneratorType</code>、<code>ArrayLiteralConvertible</code>都已改名。</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://lijun.xyz/2016/08/07/MYArray-Swift/" data-id="ckilyqj920004yps632tf56av" data-title="《Advanced Swift》笔记3：如何自己实现一个Swift数组" class="article-share-link">Teilen</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Programming/" rel="tag">Programming</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Swift/" rel="tag">Swift</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Swift数组变形2" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2016/07/31/Swift%E6%95%B0%E7%BB%84%E5%8F%98%E5%BD%A22/" class="article-date">
  <time class="dt-published" datetime="2016-07-31T11:58:30.000Z" itemprop="datePublished">2016-07-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programming/">Programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2016/07/31/Swift%E6%95%B0%E7%BB%84%E5%8F%98%E5%BD%A22/">《Advanced Swift》笔记2：数组变形（二）—— filter 和 reduce</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>本文将介绍<code>filter</code>和<code>reduce</code>两个高阶函数的使用和内部实现。</p>
</blockquote>
<h2 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h2><p><code>filter</code>方法可以过滤掉数组中不符合条件的元素，返回包含所有符合条件的元素的数组。比如现在需要选出一个数组中所有的偶数，传统的做法是这样的</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="keyword">var</span> evens = [<span class="type">Int</span>]()</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> numbers &#123;</span><br><span class="line">  <span class="keyword">if</span> num % <span class="number">2</span> == <span class="number">0</span> &#123;</span><br><span class="line">    evens.append(num)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(evens)  <span class="comment">// [2,4]</span></span><br></pre></td></tr></table></figure>

<p>和<code>map</code>方法一样，<code>filter</code>也是讲for循环中的代码块用闭包封装了，我们只需要在闭包中传入筛选条件即可：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="keyword">let</span> evens = numbers.<span class="built_in">filter</span>&#123;$<span class="number">0</span> % <span class="number">2</span> == <span class="number">0</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(evens)  <span class="comment">// [2,4]</span></span><br></pre></td></tr></table></figure>

<p>使用<code>filter</code>方法的优点和<code>map</code>方法一样，代码简洁、语义清晰、更安全。</p>
<p><code>filter</code>的内部实现和<code>map</code>差不多，就是在像新数组添加元素时增加了一个条件判断。可以这样实现它：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Array</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">my_filter</span><span class="params">(includeElement: Element -&gt; Bool)</span></span> -&gt; [<span class="type">Element</span>] &#123;</span><br><span class="line">    <span class="keyword">var</span> result: [<span class="type">Element</span>] = []</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="keyword">self</span> <span class="keyword">where</span> includeElement(x) &#123;</span><br><span class="line">      result.append(x)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://github.com/apple/swift/blob/master/stdlib/public/core/Filter.swift.gyb">点击查看源码</a>，然而我并没有完全看懂，囧。</p>
<h2 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">SequenceType</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// Returns the result of repeatedly calling `combine` with an</span></span><br><span class="line">    <span class="comment">/// accumulated value initialized to `initial` and each element of</span></span><br><span class="line">    <span class="comment">/// `self`, in turn, i.e. return</span></span><br><span class="line">    <span class="comment">/// `combine(combine(...combine(combine(initial, self[0]),</span></span><br><span class="line">    <span class="comment">/// self[1]),...self[count-2]), self[count-1])`.</span></span><br><span class="line">    <span class="meta">@warn_unused_result</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">reduce</span>&lt;T&gt;<span class="params">(initial: T, @noescape combine: <span class="params">(T, <span class="keyword">Self</span>.Generator.Element)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">T</span>) <span class="keyword">rethrows</span> -&gt; <span class="type">T</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从文档来看，<code>reduce</code>方法就是传入一个初始值和合并函数，然后计算合并后的值并返回，相比之前的<code>map</code>,<code>flatMap</code>,<code>filter</code>都是返回一个新的数组不同，这里只是返回一个元素合并后的新元素。比如我们想要将数组的元素全部加起来，可以这样写：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">let</span> numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="keyword">var</span> result = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> numbers &#123;</span><br><span class="line">  result = result + num</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">reduce</span>)  <span class="comment">// 15</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>用<code>reduce</code>，也只需要一句代码：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="keyword">let</span> <span class="built_in">reduce</span> = numbers.<span class="built_in">reduce</span>(<span class="number">0</span>, combine: +)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">reduce</span>)  <span class="comment">// 15</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>因为在Swift中，运算符也是函数，因此可以将运算符作为参数传入。<br>我们可以这样实现一个<code>reduce</code>函数：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Array</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">my_reduce</span>&lt;U&gt;<span class="params">(initial: U, combine: <span class="params">(U, Element)</span></span></span> -&gt; <span class="type">U</span>) -&gt; <span class="type">U</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> result = initial</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="keyword">self</span> &#123;</span><br><span class="line">      result = combine(result, x)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br></pre></td></tr></table></figure>



      
    </div>
    <footer class="article-footer">
      <a data-url="http://lijun.xyz/2016/07/31/Swift%E6%95%B0%E7%BB%84%E5%8F%98%E5%BD%A22/" data-id="ckilyqj9f000oyps638nvboqq" data-title="《Advanced Swift》笔记2：数组变形（二）—— filter 和 reduce" class="article-share-link">Teilen</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Programming/" rel="tag">Programming</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Swift/" rel="tag">Swift</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Swift-数组变形1" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2016/07/31/Swift-%E6%95%B0%E7%BB%84%E5%8F%98%E5%BD%A21/" class="article-date">
  <time class="dt-published" datetime="2016-07-31T09:37:31.000Z" itemprop="datePublished">2016-07-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programming/">Programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2016/07/31/Swift-%E6%95%B0%E7%BB%84%E5%8F%98%E5%BD%A21/">《Advanced Swift》笔记1：数组变形（一） —— map 和 flatMap</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p><code>map</code>和<code>flatMap</code>是Swift数组中的两个高阶函数，他们能很方便的对数组内的所有元素进行操作，然后返回一个新的数组。本文将探索这两个函数的实际使用以及其内部实现。</p>
</blockquote>
<!--- more --->

<h2 id="map"><a href="#map" class="headerlink" title="map"></a>map</h2><p>在objective-c中，如果我们要对一个数组里的每个元素进行操作，我们都是通过写<code>for</code>循环来遍历数组，然后在再对元素进行操作。比如我们要对一个数组中的所以元素做平方，并返回新的数组，我们可以这样写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    NSArray *array &#x3D; @[@(1), @(3), @(5), @(6)];</span><br><span class="line">    NSMutableArray *sauared &#x3D; [NSMutableArray array];</span><br><span class="line">    for (NSNumber *number in array) &#123;</span><br><span class="line">      NSInteger num &#x3D; number.integerValue;</span><br><span class="line">      [sauared addObject:@(num * num)];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    NSLog(@&quot;%@&quot;, sauared);</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; 最后的输出为：</span><br><span class="line">    2016-07-31 15:20:52.497 Array[9945:5153603] (</span><br><span class="line">    1,</span><br><span class="line">    9,</span><br><span class="line">    25,</span><br><span class="line">    36</span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在Swift中，为数组提供了一个<code>map</code>方法来做这件事，因此上面的代码在Swift中可以这样写：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">let</span> sauared = x.<span class="built_in">map</span>&#123;$<span class="number">0</span> * $<span class="number">0</span>&#125;</span><br><span class="line"><span class="comment">// sauared = [1, 4, 9]</span></span><br></pre></td></tr></table></figure>

<p>使用<code>map</code>方法的优势很明显：</p>
<ul>
<li>代码会变得非常简洁，一句代码就能搞定，代码量变少了，也意味着出错的概率变小了。</li>
<li>语义更加明确，也就是代码可读性更好。通过<code>map</code>这个方法名，我们一眼就知道这个方法要做什么，而如果是通过<code>for</code>循环，我们必须看完整个上下文的代码的才知道在做什么。</li>
<li>在Swift中使用<code>map</code>还有一个优点就是能使用<code>let</code>把新的数组定义为不可变量。如果是用<code>for</code>循环，因为要在循环中逐个添加新的数组元素，因此新的数组必须要用<code>var</code>来定义。这样也提高了代码的安全性。</li>
</ul>
<h3 id="map-的内部实现"><a href="#map-的内部实现" class="headerlink" title="map 的内部实现"></a>map 的内部实现</h3><p><code>map</code>函数的内部实现原理也非常简单，就是把<code>for</code>循环中的代码用一个泛型函数封装起来了。<a target="_blank" rel="noopener" href="https://github.com/apple/swift/blob/master/stdlib/public/core/Collection.swift#L1243">源码地址</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">map</span>&lt;T&gt;<span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">_</span> transform: @noescape <span class="params">(Iterator.Element)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">T</span></span><br><span class="line">  ) <span class="keyword">rethrows</span> -&gt; [<span class="type">T</span>] &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> swift-3-indexing-model - review the following</span></span><br><span class="line">    <span class="keyword">let</span> <span class="built_in">count</span>: <span class="type">Int</span> = <span class="built_in">numericCast</span>(<span class="keyword">self</span>.<span class="built_in">count</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">count</span> == <span class="number">0</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> []</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> result = <span class="type">ContiguousArray</span>&lt;<span class="type">T</span>&gt;()</span><br><span class="line">    result.reserveCapacity(<span class="built_in">count</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> i = <span class="keyword">self</span>.startIndex</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">_</span> <span class="keyword">in</span> <span class="number">0</span>..&lt;<span class="built_in">count</span> &#123;</span><br><span class="line">      result.append(<span class="keyword">try</span> transform(<span class="keyword">self</span>[i]))</span><br><span class="line">      formIndex(after: &amp;i)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _expectEnd(i, <span class="keyword">self</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Array</span>(result)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>我们也可以这样简单地实现：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Array</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">my_map</span>&lt;U&gt;<span class="params">(transform: Element -&gt; U)</span></span> -&gt; [<span class="type">U</span>] &#123;</span><br><span class="line">    <span class="keyword">var</span> result: [<span class="type">U</span>] = []</span><br><span class="line">    result.reserveCapacity(<span class="keyword">self</span>.<span class="built_in">count</span>)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="keyword">self</span> &#123;</span><br><span class="line">      result.append(transform(x))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="flatMap"><a href="#flatMap" class="headerlink" title="flatMap"></a>flatMap</h2><p><code>flatMap</code>和<code>map</code>很像，都是对数组中每个元素进行操作转换，但<code>flatMap</code>会做两件额外的事，一是将结果数组展平，如果结果数组中的元素也是一个数组，就会将这个数组展平；二是会把数组中的<code>nil</code>过滤，返回一个不包含<code>nil</code>的数组。这两个额外的操作，其实是分别对应<code>flatMap</code>的两个方法, 因此在一个<code>flatMap</code>方法中这两个额外操作是不能同时执行的。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">SequenceType</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// Returns an `Array` containing the concatenated results of mapping</span></span><br><span class="line">    <span class="comment">/// `transform` over `self`.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">///     s.flatMap(transform)</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// is equivalent to</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">///     Array(s.map(transform).flatten())</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Complexity: O(*M* + *N*), where *M* is the length of `self`</span></span><br><span class="line">    <span class="comment">///   and *N* is the length of the result.</span></span><br><span class="line">    <span class="meta">@warn_unused_result</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">flatMap</span>&lt;S : SequenceType&gt;<span class="params">(transform: <span class="params">(<span class="keyword">Self</span>.Generator.Element)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">S</span>) <span class="keyword">rethrows</span> -&gt; [<span class="type">S</span>.<span class="type">Generator</span>.<span class="type">Element</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">SequenceType</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// Returns an `Array` containing the non-nil results of mapping</span></span><br><span class="line">    <span class="comment">/// `transform` over `self`.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Complexity: O(*M* + *N*), where *M* is the length of `self`</span></span><br><span class="line">    <span class="comment">///   and *N* is the length of the result.</span></span><br><span class="line">    <span class="meta">@warn_unused_result</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">flatMap</span>&lt;T&gt;<span class="params">(@noescape transform: <span class="params">(<span class="keyword">Self</span>.Generator.Element)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">T?</span>) <span class="keyword">rethrows</span> -&gt; [<span class="type">T</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>从文档中我们可以看到第一个<code>flatMap</code>的调用者中的元素其实是一个数组（SequenceType），返回的是一个完全展开的一次数组，通过实际代码，我们可以看出其中的区别：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> array = [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>]]</span><br><span class="line"><span class="keyword">let</span> mapArray = array.<span class="built_in">map</span>&#123;$<span class="number">0</span>.<span class="built_in">map</span>&#123;$<span class="number">0</span> * $<span class="number">0</span>&#125;&#125;</span><br><span class="line"><span class="comment">// mapArray = [[1,4,9,16],[25,36,49]]</span></span><br><span class="line"><span class="keyword">let</span> flatMapArray = array.flatMap&#123;$<span class="number">0</span>.<span class="built_in">map</span>&#123;$<span class="number">0</span> * $<span class="number">0</span>&#125;&#125;</span><br><span class="line"><span class="comment">// flatMapArray = [1,4,9,16,25,36,49]</span></span><br></pre></td></tr></table></figure>

<p>文档的解释是第一个<code>flatMap</code>函数相当于<code>Array(s.map(transform).flatten())</code></p>
<p>第二个<code>flatMap</code>方法则会返回一个不带<code>nil</code>的数组，示例如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> nilArray: [<span class="type">Any?</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="literal">nil</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">let</span> mapArray = nilArray.<span class="built_in">map</span>&#123;$<span class="number">0</span>&#125;</span><br><span class="line"><span class="comment">// mapArray = [1,2,nil,3]</span></span><br><span class="line"><span class="keyword">let</span> flatMapArray = nilArray.flatMap&#123;$<span class="number">0</span>&#125;</span><br><span class="line"><span class="comment">// flatMapArray = [1,2,3]</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>小思考：下面的代码各会返回什么结果</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sArray: [[<span class="type">Int?</span>]] = [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="literal">nil</span>, <span class="number">4</span>]]</span><br><span class="line">sArray.flatMap&#123;$<span class="number">0</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> array = [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="number">4</span>, [<span class="number">5</span>, <span class="number">6</span>]]</span><br><span class="line">array.flatMap&#123;$<span class="number">0</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> array: [<span class="type">Any?</span>] = [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="number">4</span>, [<span class="number">5</span>, <span class="number">6</span>], <span class="literal">nil</span>]</span><br><span class="line">array.flatMap&#123;$<span class="number">0</span>&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="flatMap-的内部实现"><a href="#flatMap-的内部实现" class="headerlink" title="flatMap 的内部实现"></a>flatMap 的内部实现</h3><p>第一个<code>flatMap</code>的<a target="_blank" rel="noopener" href="https://github.com/apple/swift/blob/master/stdlib/public/core/SequenceAlgorithms.swift.gyb#L627">源码地址</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">flatMap</span>&lt;SegmentOfResult : Sequence&gt;<span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">_</span> transform: @noescape <span class="params">($&#123;GElement&#125;)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">SegmentOfResult</span></span><br><span class="line">  ) <span class="keyword">rethrows</span> -&gt; [<span class="type">SegmentOfResult</span>.$&#123;<span class="type">GElement</span>&#125;] &#123;</span><br><span class="line">    <span class="keyword">var</span> result: [<span class="type">SegmentOfResult</span>.$&#123;<span class="type">GElement</span>&#125;] = []</span><br><span class="line">    <span class="keyword">for</span> element <span class="keyword">in</span> <span class="keyword">self</span> &#123;</span><br><span class="line">      result.append(contentsOf: <span class="keyword">try</span> transform(element))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>从源码中我们可以发现，<code>flatMap</code>方法之所以能将数组展开，关键是在添加结果是使用的是<code>appendContentsOf</code>方法，这个方法能把数组中的元素取出，放入一个新数组中。</p>
<p>第二个<code>flatMap</code>的<a target="_blank" rel="noopener" href="https://github.com/apple/swift/blob/master/stdlib/public/core/SequenceAlgorithms.swift.gyb#L663">源码地址</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">flatMap</span>&lt;ElementOfResult&gt;<span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">_</span> transform: @noescape <span class="params">($&#123;GElement&#125;)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">ElementOfResult?</span></span><br><span class="line">  ) <span class="keyword">rethrows</span> -&gt; [<span class="type">ElementOfResult</span>] &#123;</span><br><span class="line">    <span class="keyword">var</span> result: [<span class="type">ElementOfResult</span>] = []</span><br><span class="line">    <span class="keyword">for</span> element <span class="keyword">in</span> <span class="keyword">self</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">let</span> newElement = <span class="keyword">try</span> transform(element) &#123;</span><br><span class="line">        result.append(newElement)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br></pre></td></tr></table></figure>

<p>第二个<code>flatMap</code>方法内部则使用了一个<code>if let</code>判断来过滤<code>nil</code>元素。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://lijun.xyz/2016/07/31/Swift-%E6%95%B0%E7%BB%84%E5%8F%98%E5%BD%A21/" data-id="ckilyqj9d000hyps68gp2eeb8" data-title="《Advanced Swift》笔记1：数组变形（一） —— map 和 flatMap" class="article-share-link">Teilen</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Programming/" rel="tag">Programming</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Swift/" rel="tag">Swift</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Swift-Transforming-Arrays" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2016/07/30/Swift-Transforming-Arrays/" class="article-date">
  <time class="dt-published" datetime="2016-07-30T12:23:36.000Z" itemprop="datePublished">2016-07-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programming/">Programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2016/07/30/Swift-Transforming-Arrays/">Swift Transforming Arrays</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Swift-Transforming-Arrays"><a href="#Swift-Transforming-Arrays" class="headerlink" title="Swift Transforming Arrays"></a>Swift Transforming Arrays</h1><p>——by《Advanced Swift》</p>
<p>In Swift, Array object has a number of Transforming methods, there are map, filter, reduce, flatMap, etc.</p>
<h2 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h2><p>Every programmer has writtern similar code hundreds of times: create a new array, loop over all elements in an existing array, perform an operation on an element, and append the result of that operation to the new array. For example, the follwing code squares an array of integers:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fibs = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="keyword">var</span> sauared: [<span class="type">Int</span>] = []</span><br><span class="line"><span class="keyword">for</span> fib <span class="keyword">in</span> fibs &#123;</span><br><span class="line">  sauared.append(fib * fib)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Swift arrays have a map method, adopted from the world of functional programming. This method can perform a transformation on every value in the array. So, the above code can write like this:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sauared = fibs.<span class="built_in">map</span> &#123; fib <span class="keyword">in</span> fib * fib &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Use map method has three main advantages:</p>
<ul>
<li>It’s shorter, and more importantly, it’s clearer. The map acts a signal, you know immediately what is happening when you see it: a function is going to be applied to every element, returning a new array of the transformed elements.</li>
<li>We can declare <code>squared</code> with <code>let</code>, because we aren’t mutating it any longer when use <code>map</code> method.</li>
<li><code>map</code> isn’t hard to write – it’s just need to wrapping up the boilerplate parts of the <code>for</code> loop into a generic function. Here’s one possible implementaion:</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Array</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">my_map</span>&lt;U&gt;<span class="params">(transform: Element -&gt; U)</span></span> -&gt; [<span class="type">U</span>] &#123;</span><br><span class="line">    <span class="keyword">var</span> result: [<span class="type">U</span>] = []</span><br><span class="line">    result.reserveCapacity(<span class="keyword">self</span>.<span class="built_in">count</span>)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="keyword">self</span> &#123;</span><br><span class="line">      result.append(transform(x))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Parameterizing-Behavior-with-Functions"><a href="#Parameterizing-Behavior-with-Functions" class="headerlink" title="Parameterizing Behavior with Functions"></a>Parameterizing Behavior with Functions</h2><p><code>map</code> manages to separate out the boilerplate functionality – which doesn’t vary from call to call –   from the funcionality that always varies: the logic of how exactly to fransform each element.<br>This pattern of parameterizing behavior is found throughout the standard library. There are 13 separate functions that take a closure that allows the caller to customize the key step:</p>
<ul>
<li><code>map</code> and <code>flatMap</code> – how to tranform an element</li>
<li><code>filter</code> – should an element be included?</li>
<li><code>reduce</code> – how fo fold an element into an aggregate value</li>
<li><code>sort</code> and <code>lexicographicCompare</code> – in what order should two elements come?</li>
<li><code>indexOf</code> and <code>contains</code> – does this elements match</li>
<li><code>minElement</code> and <code>maxElement</code> – which is the min/max of two elements?</li>
<li><code>elementsEqual</code> and <code>startsWith</code> – are two elements equivalent?</li>
<li><code>split</code> – is this element a separator?</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://lijun.xyz/2016/07/30/Swift-Transforming-Arrays/" data-id="ckilyqj9b000fyps61nd9fwlw" data-title="Swift Transforming Arrays" class="article-share-link">Teilen</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Programming/" rel="tag">Programming</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Swift/" rel="tag">Swift</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-ruby-english" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2016/05/14/ruby-english/" class="article-date">
  <time class="dt-published" datetime="2016-05-14T15:27:07.000Z" itemprop="datePublished">2016-05-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programming/">Programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2016/05/14/ruby-english/">Ruby basics</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="how-to-learn-ruby"><a href="#how-to-learn-ruby" class="headerlink" title="how to learn ruby"></a>how to learn ruby</h2><blockquote>
<p>the best way to learn how to code is to actually code. so please go ahead and copy the examples from the github repository that will be provided and follow along the example. Experiment in the editor by typing, by modifying the examples and executing the examples and seeing what happens. That’s the only way to learn how to code.</p>
</blockquote>
<!--- more --->

<h2 id="Ruby-basics"><a href="#Ruby-basics" class="headerlink" title="Ruby basics"></a>Ruby basics</h2><h3 id="Ruby-is-an-Object-Oriented-Language"><a href="#Ruby-is-an-Object-Oriented-Language" class="headerlink" title="Ruby is an Object-Oriented Language"></a>Ruby is an Object-Oriented Language</h3><blockquote>
<p>Ruby is a genuine object-oriented language, and pretty much everything in Ruby is an object.</p>
</blockquote>
<p>for example the number <code>5</code> in ruby is an object of the class called <code>Fixnum</code></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">irb(main)<span class="symbol">:</span><span class="number">011</span><span class="symbol">:</span><span class="number">0</span>* <span class="number">5</span></span><br><span class="line">=&gt; <span class="number">5</span></span><br><span class="line"><span class="meta">irb(main):012:0&gt;</span> <span class="number">5</span>.class</span><br><span class="line">=&gt; Fixnum</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="flow-of-control-in-Ruby"><a href="#flow-of-control-in-Ruby" class="headerlink" title="flow of control in Ruby"></a>flow of control in Ruby</h3><p>tips:</p>
<p>false and nil objects are false<br>everthing else is true include 0</p>
<p>triple equal ==&gt; === is called the case equality operator because it is used in precisely this case!<br>most of the time triple equals just delegates to a double equals, so it’s almost like a super set of a double equals.</p>
<p>3 flavors</p>
<ul>
<li>regular expression</li>
<li>double equals</li>
<li>comparing the value class</li>
</ul>
<h3 id="Functions-and-Methods"><a href="#Functions-and-Methods" class="headerlink" title="Functions and Methods"></a>Functions and Methods</h3><ul>
<li>Technically, a function is defined outside of a class and a method is defined inside a class.</li>
<li>In Ruby, every function/method has at least one class it blongs to. Not always written inside a class.</li>
</ul>
<p> **Methods: **</p>
<p> Methods are invoked by sending a message to an object.</p>
<ul>
<li>Parentheses(“()”) are optional both when defining and calling a method</li>
<li>No need to declare type of parameters</li>
<li>Can return whatever you want</li>
<li>return keyword is optional(last executed line returned)</li>
<li>Method names can end with:<ul>
<li>‘?’-predicate methods</li>
<li>‘!’-dangerous side-effects</li>
</ul>
</li>
<li>Methods  can have default arguments</li>
</ul>
<h3 id="Blocks"><a href="#Blocks" class="headerlink" title="Blocks"></a>Blocks</h3><ul>
<li>Chunksof code<ul>
<li>Enclosed between either curly braces({}) when block content is single line or the keywords <code>do</code> and <code>end</code> when block content spans multiple lines.</li>
<li>Passed to methods as last “parameter”</li>
</ul>
</li>
<li>Coding with blocks<ul>
<li>two ways to configure a block in your own method<ul>
<li>Implicit<ul>
<li>use `block_given?’ to see if block was passed in</li>
<li>use ‘yield’ to “call” the block</li>
</ul>
</li>
<li>Explicit<ul>
<li>use <code>&amp;</code> in front of the last “parameter”</li>
<li>use call method to call the block</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="files"><a href="#files" class="headerlink" title="files"></a>files</h3><ul>
<li>read file:</li>
</ul>
<pre><code><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">irb(main):001:0&gt;</span> File.foreach(<span class="string">&#x27;test.txt&#x27;</span>) do <span class="params">|line|</span></span><br><span class="line">irb(main)<span class="symbol">:</span><span class="number">002</span><span class="symbol">:</span><span class="number">1</span>* puts line</span><br><span class="line"><span class="meta">irb(main):003:1&gt;</span> p line</span><br><span class="line"><span class="meta">irb(main):004:1&gt;</span> p line.chomp</span><br><span class="line"><span class="meta">irb(main):005:1&gt;</span> p line.split</span><br><span class="line"><span class="meta">irb(main):006:1&gt;</span> end</span><br></pre></td></tr></table></figure></code></pre>
<ul>
<li><p>write file</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># override the file</span></span><br><span class="line"><span class="meta">irb(main):007:0&gt;</span> File.open(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) do <span class="params">|file|</span></span><br><span class="line">irb(main)<span class="symbol">:</span>008<span class="symbol">:</span><span class="number">1</span>* file.puts <span class="string">&quot;one line&quot;</span></span><br><span class="line"><span class="meta">irb(main):009:1&gt;</span> file.puts <span class="string">&quot;second line&quot;</span></span><br><span class="line"><span class="meta">irb(main):010:1&gt;</span> end</span><br></pre></td></tr></table></figure>


</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://lijun.xyz/2016/05/14/ruby-english/" data-id="ckilyqja90041yps6b9od30kd" data-title="Ruby basics" class="article-share-link">Teilen</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/English/" rel="tag">English</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Programming/" rel="tag">Programming</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Ruby/" rel="tag">Ruby</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/2/">&laquo; zurück</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/">weiter &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Kategorien</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Programming/">Programming</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Project/">Project</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Reading/">Reading</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tech/">Tech</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Thinking/">Thinking</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/APP/" rel="tag">APP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Apple/" rel="tag">Apple</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Data-structure/" rel="tag">Data structure</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/English/" rel="tag">English</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Macbook/" rel="tag">Macbook</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Performance/" rel="tag">Performance</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Programming/" rel="tag">Programming</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Project/" rel="tag">Project</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Protocol/" rel="tag">Protocol</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Reading/" rel="tag">Reading</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Realm/" rel="tag">Realm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ruby/" rel="tag">Ruby</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SICP/" rel="tag">SICP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Steve-Jobs/" rel="tag">Steve Jobs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/String/" rel="tag">String</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Swift/" rel="tag">Swift</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Thinking/" rel="tag">Thinking</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UITableView/" rel="tag">UITableView</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/clean-code/" rel="tag">clean-code</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kindle/" rel="tag">kindle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/programming/" rel="tag">programming</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reading/" rel="tag">reading</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BF%AF%E5%8D%A7%E6%92%91/" rel="tag">俯卧撑</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%81%A5%E8%BA%AB/" rel="tag">健身</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9D%9A%E6%8C%81/" rel="tag">坚持</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%80%BB%E8%BE%91%E6%80%9D%E7%BB%B4/" rel="tag">逻辑思维</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/APP/" style="font-size: 10px;">APP</a> <a href="/tags/Apple/" style="font-size: 10px;">Apple</a> <a href="/tags/Data-structure/" style="font-size: 10px;">Data structure</a> <a href="/tags/English/" style="font-size: 10px;">English</a> <a href="/tags/Macbook/" style="font-size: 12px;">Macbook</a> <a href="/tags/Performance/" style="font-size: 10px;">Performance</a> <a href="/tags/Programming/" style="font-size: 18px;">Programming</a> <a href="/tags/Project/" style="font-size: 10px;">Project</a> <a href="/tags/Protocol/" style="font-size: 14px;">Protocol</a> <a href="/tags/Reading/" style="font-size: 12px;">Reading</a> <a href="/tags/Realm/" style="font-size: 10px;">Realm</a> <a href="/tags/Ruby/" style="font-size: 12px;">Ruby</a> <a href="/tags/SICP/" style="font-size: 10px;">SICP</a> <a href="/tags/Steve-Jobs/" style="font-size: 10px;">Steve Jobs</a> <a href="/tags/String/" style="font-size: 10px;">String</a> <a href="/tags/Swift/" style="font-size: 20px;">Swift</a> <a href="/tags/Thinking/" style="font-size: 16px;">Thinking</a> <a href="/tags/UITableView/" style="font-size: 10px;">UITableView</a> <a href="/tags/clean-code/" style="font-size: 10px;">clean-code</a> <a href="/tags/kindle/" style="font-size: 10px;">kindle</a> <a href="/tags/programming/" style="font-size: 10px;">programming</a> <a href="/tags/reading/" style="font-size: 10px;">reading</a> <a href="/tags/%E4%BF%AF%E5%8D%A7%E6%92%91/" style="font-size: 10px;">俯卧撑</a> <a href="/tags/%E5%81%A5%E8%BA%AB/" style="font-size: 10px;">健身</a> <a href="/tags/%E5%9D%9A%E6%8C%81/" style="font-size: 10px;">坚持</a> <a href="/tags/%E9%80%BB%E8%BE%91%E6%80%9D%E7%BB%B4/" style="font-size: 10px;">逻辑思维</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/12/12/learn-english/">英语学习方法</a>
          </li>
        
          <li>
            <a href="/2020/12/12/habit-and-goal/">忘记目标，专注于体系——《掌控习惯》读书笔记</a>
          </li>
        
          <li>
            <a href="/2020/12/05/macbookpro-m1/">iOS 程序员使用M1芯片MacBook Pro两天体验</a>
          </li>
        
          <li>
            <a href="/2020/11/21/LinkedList/">Swift实现数据结构与算法1-链表</a>
          </li>
        
          <li>
            <a href="/2018/12/04/macbookpro-2018/">从2014款13寸MacBook Pro升级到2018款15寸MacBook Pro使用体验</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2020 lijun<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>